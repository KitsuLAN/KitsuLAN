# ============================================================
# KitsuLAN Core — Environment Configuration
# Скопируйте этот файл в .env и заполните значениями.
# ============================================================

# --- Application ---
# Режим запуска: development | production
# В production логи пишутся в JSON, уровень Info.
APP_ENV=development

# Таймауты для gRPC
READ_TIMEOUT=30s
WRITE_TIMEOUT=30s

# --- Network & Ports ---
# Адрес прослушивания (обычно 0.0.0.0 для Docker)
LISTEN_ADDR=0.0.0.0

# Основной gRPC порт API
# Так же публикуется healthcheck gRPC-эндпоинт /health
PUBLIC_API_PORT=8090

# Порт для healthcheck http-эндпоинта /healthz (Docker/K8s probes)
HEALTH_PORT=8091

# Порт для Prometheus metrics http-эндпоинт /metrics
METRICS_PORT=8092

# --- Database ---
# Выбор драйвера: postgres | sqlite
DB_DRIVER=postgres

# PostgreSQL Configuration
DB_HOST=postgres
DB_PORT=5432
DB_USER=kitsu
DB_PASSWORD=kitsu_password
DB_NAME=kitsulan
# Режимы SSL: disable | require | verify-full
DB_SSL_MODE=disable

# SQLite Configuration (используется, если DB_DRIVER=sqlite)
DB_SQLITE_PATH=kitsulan.db

# --- JWT Authentication ---
# Секретный ключ для подписи токенов.
# ВНИМАНИЕ: В production должен быть минимум 32 символа!
# Сгенерировать можно командой: openssl rand -hex 32
JWT_SECRET=dev-secret-change-this-in-production-please

# Время жизни токенов
JWT_ACCESS_TTL=24h
JWT_REFRESH_TTL=168h

# --- Caching (Multi-level) ---
# Включить кэширование глобально (true/false)
CACHE_ENABLED=true
CACHE_NAMESPACE=kitsulan-core
CACHE_VERSION=v1
CACHE_TTL=10m
# Jitter (разброс TTL) для предотвращения Cache Stampede (0.0 - 1.0)
CACHE_TTL_JITTER=0.15

# L2 Cache: Redis Configuration
# Обязательно, если CACHE_ENABLED=true
REDIS_ADDR=redis:6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_CACHE_FAILOVER=false
REDIS_DIAL_TIMEOUT=2s
REDIS_READ_TIMEOUT=500ms
REDIS_WRITE_TIMEOUT=500ms

# L1 Cache: Ristretto (In-Memory)
# Обычно повторяет CACHE_ENABLED, но можно выключить отдельно
CACHE_L1_ENABLED=true
# Максимальная стоимость (размер) кэша в байтах (100MB = 104857600)
CACHE_L1_MAX_COST=104857600
# Ожидаемое количество ключей * 10 (для Bloom filter)
CACHE_L1_NUM_COUNTERS=1000000
CACHE_L1_TTL=5m
CACHE_L1_METRICS=false

# --- External Services (Future Phases) ---

# LiveKit (WebRTC SFU) - Phase 3
LIVEKIT_URL=
LIVEKIT_KEY=
LIVEKIT_SECRET=

# S3 Compatible Storage (MinIO/AWS) - Phase 4
S3_ENDPOINT=minio:9000
S3_ACCESS_KEY=kitsu_minio
S3_SECRET_KEY=kitsu_minio_password
S3_BUCKET=kitsulan
S3_USE_SSL=false